<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora Solar Bolivia On-Grid</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; }
        .glass-card { 
            background: rgba(255, 255, 255, 0.9); 
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
    </style>
</head>
<body class="bg-[#f8fafc] text-slate-900 min-h-screen">

    <div class="max-w-5xl mx-auto px-4 py-10">
        <!-- Header -->
        <header class="text-center mb-10">
            <span class="bg-yellow-100 text-yellow-700 text-xs font-bold px-3 py-1 rounded-full uppercase tracking-wider">Energía Limpia Bolivia</span>
            <h1 class="text-4xl font-extrabold text-slate-800 mt-3 mb-2">Estimador Solar On-Grid</h1>
            <p class="text-slate-500 max-w-lg mx-auto">Calcula tu sistema fotovoltaico según tu ubicación y consumo real.</p>
        </header>

        <div class="grid lg:grid-cols-3 gap-8">
            <!-- Columna de Configuración -->
            <div class="lg:col-span-1 space-y-6">
                <div class="glass-card p-6 rounded-3xl shadow-xl">
                    <h2 class="text-lg font-bold mb-5 flex items-center gap-2">
                        <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"></path></svg>
                        Configuración
                    </h2>
                    
                    <div class="space-y-4">
                        <!-- Departamento -->
                        <div>
                            <label class="block text-sm font-semibold text-slate-700 mb-1">Departamento</label>
                            <select id="departamento" onchange="calcular()" class="w-full p-3 rounded-xl border-slate-200 bg-slate-50 focus:ring-2 focus:ring-blue-500 outline-none transition-all cursor-pointer">
                                <option value="5.5" selected>La Paz (5.5 HSP)</option>
                                <option value="5.8">Oruro (5.8 HSP)</option>
                                <option value="5.7">Potosí (5.7 HSP)</option>
                                <option value="5.2">Cochabamba (5.2 HSP)</option>
                                <option value="5.0">Chuquisaca (5.0 HSP)</option>
                                <option value="4.8">Tarija (4.8 HSP)</option>
                                <option value="4.5">Santa Cruz (4.5 HSP)</option>
                                <option value="4.2">Beni (4.2 HSP)</option>
                                <option value="4.0">Pando (4.0 HSP)</option>
                            </select>
                        </div>

                        <!-- Consumo -->
                        <div>
                            <label class="block text-sm font-semibold text-slate-700 mb-1">Consumo Mensual (kWh/mes)</label>
                            <div class="relative">
                                <input type="number" id="consumo" value="350" oninput="calcular()" class="w-full p-3 pl-4 rounded-xl border-slate-200 bg-slate-50 focus:ring-2 focus:ring-blue-500 outline-none transition-all">
                                <span class="absolute right-4 top-3 text-slate-400 text-sm">kWh</span>
                            </div>
                        </div>

                        <!-- Potencia Panel (Dinámico) -->
                        <div>
                            <label class="block text-sm font-semibold text-slate-700 mb-1">Potencia de Panel Disponible</label>
                            <select id="potencia" onchange="calcular()" class="w-full p-3 rounded-xl border-slate-200 bg-slate-50 focus:ring-2 focus:ring-blue-500 outline-none transition-all cursor-pointer">
                                <!-- Se llena por JS -->
                            </select>
                            <p id="msg-potencia" class="text-[10px] mt-2 font-medium text-blue-600 uppercase tracking-tighter"></p>
                        </div>
                    </div>
                </div>

                <div class="bg-slate-800 p-6 rounded-3xl shadow-xl text-white">
                    <h3 class="text-sm font-bold opacity-60 uppercase mb-4">Eficiencia On-Grid</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-sm">Factor de Pérdidas</span>
                            <span class="font-mono text-yellow-400">23%</span>
                        </div>
                        <div class="w-full bg-slate-700 h-1.5 rounded-full overflow-hidden">
                            <div class="bg-yellow-400 h-full" style="width: 77%"></div>
                        </div>
                        <p class="text-[10px] opacity-50 mt-2 italic">Cálculo basado en estándar boliviano (PR = 0.77).</p>
                    </div>
                </div>
            </div>

            <!-- Columna de Resultados y Gráfica -->
            <div class="lg:col-span-2 space-y-6">
                <!-- Panel de Resultados Principales -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="bg-white p-8 rounded-3xl shadow-md border border-slate-100 flex flex-col items-center justify-center text-center">
                        <p class="text-slate-400 text-xs font-bold uppercase tracking-widest mb-1">Paneles Necesarios</p>
                        <div id="res-cantidad" class="text-7xl font-black text-blue-600 tracking-tighter">--</div>
                        <p id="res-tipo-panel" class="text-slate-500 text-sm mt-2 font-medium">Paneles de --W</p>
                    </div>

                    <div class="space-y-4">
                        <div class="bg-white p-5 rounded-2xl shadow-sm border border-slate-100 flex justify-between items-center">
                            <div>
                                <p class="text-slate-400 text-[10px] font-bold uppercase">Potencia Instalada</p>
                                <p id="res-total-kw" class="text-xl font-bold text-slate-800">- kWp</p>
                            </div>
                            <div class="p-3 bg-blue-50 rounded-xl text-blue-600">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                            </div>
                        </div>
                        <div class="bg-white p-5 rounded-2xl shadow-sm border border-slate-100 flex justify-between items-center">
                            <div>
                                <p class="text-slate-400 text-[10px] font-bold uppercase">Generación Diaria Promedio</p>
                                <p id="res-gen-diaria" class="text-xl font-bold text-slate-800">- kWh/día</p>
                            </div>
                            <div class="p-3 bg-yellow-50 rounded-xl text-yellow-600">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364-6.364l-.707.707M6.343 17.657l-.707.707m12.728 0l-.707-.707M6.343 6.343l-.707-.707M12 8a4 4 0 100 8 4 4 0 000-8z"></path></svg>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Gráfica -->
                <div class="bg-white p-6 md:p-8 rounded-3xl shadow-md border border-slate-100">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="font-bold text-slate-800">Balance Energético Mensual</h3>
                        <div class="flex gap-4 text-[10px] font-bold uppercase">
                            <span class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-slate-200"></span> Red</span>
                            <span class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-blue-500"></span> Solar</span>
                        </div>
                    </div>
                    <div class="relative h-64">
                        <canvas id="solarChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let myChart;
        const PR = 0.77; // Performance Ratio estándar

        function actualizarOpcionesPanel(potenciaRequeridaKW) {
            const select = document.getElementById('potencia');
            const msg = document.getElementById('msg-potencia');
            const valorActual = select.value;
            
            select.innerHTML = '';
            
            let opciones = [];
            if (potenciaRequeridaKW <= 3) {
                opciones = [200, 300, 400];
                msg.innerText = "Sistema ≤ 3kW: Paneles Residenciales";
                msg.className = "text-[10px] mt-2 font-medium text-emerald-600 uppercase tracking-tighter";
            } else {
                opciones = [405, 500, 600];
                msg.innerText = "Sistema > 3kW: Paneles de Alta Potencia";
                msg.className = "text-[10px] mt-2 font-medium text-blue-600 uppercase tracking-tighter";
            }

            opciones.forEach(opt => {
                const el = document.createElement('option');
                el.value = opt;
                el.textContent = `${opt} Watts`;
                if (opt == valorActual) el.selected = true;
                select.appendChild(el);
            });
        }

        function calcular() {
            const consumoMensual = parseFloat(document.getElementById('consumo').value) || 0;
            const hsp = parseFloat(document.getElementById('departamento').value);
            
            // Paso 1: Estimación preliminar de potencia necesaria para decidir el rango de paneles
            // P (kW) = E_diaria / (HSP * PR)
            const potenciaEstimadaKW = (consumoMensual / 30) / (hsp * PR);
            
            // Paso 2: Actualizar selector de paneles según la potencia estimada
            actualizarOpcionesPanel(potenciaEstimadaKW);

            // Paso 3: Cálculo final con el panel seleccionado
            const potenciaPanelW = parseFloat(document.getElementById('potencia').value) || 400;
            const energiaDiariaReq = consumoMensual / 30;
            
            // Num Paneles = E_diaria / (PotenciaPanel_kW * HSP * PR)
            const numPaneles = Math.ceil(energiaDiariaReq / ((potenciaPanelW / 1000) * hsp * PR));
            
            const potenciaTotalInstalada = (numPaneles * potenciaPanelW) / 1000;
            const genDiariaReal = potenciaTotalInstalada * hsp * PR;
            const genMensualReal = genDiariaReal * 30;

            // Actualizar Interfaz
            document.getElementById('res-cantidad').innerText = numPaneles;
            document.getElementById('res-tipo-panel').innerText = `Paneles de ${potenciaPanelW}W`;
            document.getElementById('res-total-kw').innerText = `${potenciaTotalInstalada.toFixed(2)} kWp`;
            document.getElementById('res-gen-diaria').innerText = `${genDiariaReal.toFixed(2)} kWh`;

            renderizarGrafica(consumoMensual, genMensualReal);
        }

        function renderizarGrafica(consumo, generacion) {
            const ctx = document.getElementById('solarChart').getContext('2d');
            
            if (myChart) myChart.destroy();

            myChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Consumo de Red', 'Producción Solar'],
                    datasets: [{
                        data: [consumo, generacion],
                        backgroundColor: ['#e2e8f0', '#3b82f6'],
                        borderRadius: 12,
                        barThickness: 60
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: (context) => ` ${context.raw.toFixed(1)} kWh/mes`
                            }
                        }
                    },
                    scales: {
                        y: { 
                            beginAtZero: true,
                            grid: { display: false },
                            ticks: { font: { size: 10 } }
                        },
                        x: { 
                            grid: { display: false },
                            ticks: { font: { weight: 'bold' } }
                        }
                    }
                }
            });
        }

        // Ejecutar primer cálculo al cargar
        window.onload = calcular;
    </script>
</body>
</html>